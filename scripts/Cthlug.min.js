function Cthlug(b,g,e,f,a,d,h,c){this.world=b;this.stage=g;this.worldwidth=e;this.worldheight=f;this.viewwidth=a;this.viewheight=d;this.worldx=h;this.worldy=c;this.dead=!1;this.textures_l=["cthlug_1_l.png","cthlug_2_l.png","cthlug_3_l.png","cthlug_4_l.png","cthlug_5_l.png"];this.textures_l_up=["cthlug_1_lup.png","cthlug_2_lup.png","cthlug_3_lup.png","cthlug_4_lup.png","cthlug_5_lup.png"];this.textures_l_down=["cthlug_1_ldown.png","cthlug_2_ldown.png","cthlug_3_ldown.png","cthlug_4_ldown.png","cthlug_5_ldown.png"];
this.textures_r=["cthlug_1_r.png","cthlug_2_r.png","cthlug_3_r.png","cthlug_4_r.png","cthlug_5_r.png"];this.textures_r_up=["cthlug_1_rup.png","cthlug_2_rup.png","cthlug_3_rup.png","cthlug_4_rup.png","cthlug_5_rup.png"];this.textures_r_down=["cthlug_1_rdown.png","cthlug_2_rdown.png","cthlug_3_rdown.png","cthlug_4_rdown.png","cthlug_5_rdown.png"];this.textures_dying="cthlug_dead_1.png cthlug_dead_2.png cthlug_dead_3.png cthlug_dead_4.png cthlug_dead_5.png cthlug_dead_6.png cthlug_dead_7.png cthlug_dead_8.png cthlug_dead_9.png cthlug_dead_10.png cthlug_dead_11.png cthlug_dead_12.png".split(" ");
this.direction=0.5>Math.random()?1:4;this.textureincrement=0;this.texturevector=1;this.deltav=new PARTSYS.Vector(0,0);this.dod=timeStamp()+5E4+2E4*Math.random();this.cthingsoundplaying=!1;this.cthingsound=new Howl({urls:["resources/sounds/placeholder.mp3"],onend:function(){this.cthingsoundplaying=!1}.bind(this)});GameObject.call(this,this.textures_l[0],36,12,e,f,a,d,h,c);this.timeoutID=setTimeout(this.updateTexture.bind(this),160)}Cthlug.constructor=Cthlug;Cthlug.prototype=Object.create(GameObject.prototype);
Cthlug.prototype.cleanup=function(){this.timeoutID&&clearTimeout(this.timeoutID);this.cthingsound.stop()};Cthlug.prototype.everySecond=function(b){timeStamp()>this.dod&&(1===this.direction||4===this.direction)&&(this.textureincrement=0,this.texturevector=1,this.direction=7)};
Cthlug.prototype.updateSound=function(){this.world.player&&(this.visible&&!this.cthingsoundplaying&&(this.cthingsoundplaying=!0,this.cthingsound.play()),!this.visible&&this.cthingsoundplaying&&(this.cthingsound.stop(),this.cthingsoundplaying=!1))};
Cthlug.prototype.updateTexture=function(b){void 0===b&&(b=!0);var g;switch(this.direction){case 1:g=this.textures_l;break;case 2:g=this.textures_l_up;break;case 3:g=this.textures_l_down;break;case 4:g=this.textures_r;break;case 5:g=this.textures_r_up;break;case 6:g=this.textures_r_down;break;case 7:g=this.textures_dying}this.textureincrement+=this.texturevector;this.textureincrement>=g.length&&(7===this.direction&&(this.dead=!0),this.texturevector=-this.texturevector,this.textureincrement=g.length-
1);0>this.textureincrement&&(this.textureincrement=1,this.texturevector=-this.texturevector);this.visible&&(g=PIXI.Texture.fromFrame(g[this.textureincrement]),this.setTexture(g));b&&(this.timeoutID=setTimeout(this.updateTexture.bind(this),160))};
Cthlug.prototype.getTouch=function(b,g,e){var f={tl:null,tr:null,bl:null,br:null,right:null,left:null,bottom:null};if(e+this.height>=this.worldheight&&(4>this.direction&&0===b||3<this.direction&&b===this.world.city.length))f.bl=!0,f.bottom=!0,f.br=!0,b={worldx:this.worldx-1,worldy:this.worldheight,width:this.width};else{if(4>this.direction&&0===b||3<this.direction&&b===this.world.city.length)return{touch:null,building:null};b=4>this.direction?this.world.city[b-1]:this.world.city[b];f.left=this.world.isCollidedPoint(b,
g,e+this.height/2,!1);f.bottom=this.world.isCollidedPoint(b,g+this.width/2,e+this.height,!1);f.right=this.world.isCollidedPoint(b,g+this.width,e+this.height/2,!1);f.tl=this.world.isCollidedPoint(b,g,e,!1);f.tr=this.world.isCollidedPoint(b,g+this.width,e,!1);f.bl=this.world.isCollidedPoint(b,g,e+this.height,!1);f.br=this.world.isCollidedPoint(b,g+this.width,e+this.height,!1)}return{touch:f,building:b}};
Cthlug.prototype.updatePosition=function(b,g){var e,f,a,d,h,c;switch(this.direction){case 1:this.deltav.x=-0.2;this.deltav.y=1;break;case 2:this.deltav.x=-0.2;this.deltav.y=-0.2;break;case 3:this.deltav.x=0.2;this.deltav.y=0.2;break;case 4:this.deltav.x=0.2;this.deltav.y=1;break;case 5:this.deltav.x=0.2;this.deltav.y=-0.2;break;case 6:this.deltav.x=-0.2;this.deltav.y=0.2;break;case 7:this.deltav.x=0,this.deltav.y=0}d=this.worldx+this.deltav.x;h=this.worldy+this.deltav.y;d>this.worldwidth&&(d=d-this.worldwidth+
1);0>d&&(d=this.worldwidth+d-1);if(4>this.direction)for(e=0;e<=this.world.city.length;e++){if(f=this.getTouch(e,d,h),c=f.touch,a=f.building,null!==c&&(c.left||c.right||c.bottom||c.tl||c.tr||c.bl||c.br)){f=this.direction;switch(this.direction){case 1:if(c.left){d=a.worldx+a.width;h-=24;this.direction=2;break}if(!c.bottom&&!c.bl){d=a.worldx-12;h=a.worldy;this.direction=3;break}h=h+12>=this.worldheight?this.worldheight-12:a.worldy-12;break;case 2:if(!c.left){d=a.worldx+a.width-36;h=a.worldy-12;this.direction=
1;break}d=a.worldx+a.width;break;case 3:if(c.bottom){d=a.worldx+a.width-36;h+=24;this.direction=1;break}d=a.worldx-12}f!=this.direction&&(this.visible=!0,this.updateTexture(!1),this.visible=!1);if(0<e)break}}else if(7>this.direction)for(e=this.world.city.length;0<=e;e--)if(f=this.getTouch(e,d,h),c=f.touch,a=f.building,null!==c&&(c.left||c.right||c.bottom||c.tl||c.tr||c.bl||c.br)){f=this.direction;switch(this.direction){case 4:if(c.right){d=a.worldx-12;h-=24;this.direction=5;break}if(!c.bottom&&!c.br){d=
a.worldx+a.width;h=a.worldy-18;this.direction=6;break}h=h+12>=this.worldheight?this.worldheight-12:a.worldy-12;break;case 5:if(!c.right){d=a.worldx-18;h=a.worldy-12;this.direction=4;break}d=a.worldx-12;break;case 6:if(c.bottom){d=a.worldx+1;h+=24;this.direction=4;break}d=a.worldx+a.width}if(f!=this.direction){this.visible=!0;this.updateTexture(!1);this.visible=!1;break}if(e<this.world.city.length)break}this.worldx=d;this.worldy=h};
Cthlug.prototype.update=function(b,g){var e,f,a,d=-1;this.visible=!1;this.updatePosition(b,g);e=this.worldx;f=this.worldy;a=b+this.viewwidth;a>this.worldwidth&&(d=a-this.worldwidth-1);-1===d?this.worldx>b-this.width&&this.worldx<a+this.width&&(e=this.worldx-b,this.visible=!0):this.worldx>b-this.width&&this.worldx<=this.worldwidth?(e=this.worldx-b,this.visible=!0):this.worldx<d+this.width&&(e=this.worldwidth-b+this.worldx,this.visible=!0);this.visible&&(this.position.x=e,this.position.y=f);this.updateSound()};
