var frametime=1E3/60;function timeStamp(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}
function Main(){this.stats=new Stats;this.stats.setMode(1);this.stats.domElement.style.position="absolute";this.stats.domElement.style.left="0px";this.stats.domElement.style.top="0px";document.getElementById("gamediv").appendChild(this.stats.domElement);this.stage=new PIXI.Stage(0);this.renderer=PIXI.autoDetectRenderer(960,595,document.getElementById("game-canvas"));this.renderer.view.className="rendererView";this.wave=1;this.score=0;this.secondTickInterval=null;this.firstinit=!0;this.everySecond=
this.gameworld=null;Howler.usingWebAudio?Howler.volume(0.5):Howler.mute();this.loadSpriteSheet()}Main.constructor=Main;Main.prototype=Object.create(Object.prototype);
Main.prototype.update=function(){var a,b;if(document.hidden)this.lasttimestamp=null;else{a=timeStamp();null===this.lasttimestamp&&(this.lasttimestamp=a);null===this.secondTickInterval?(this.secondTickInterval=a,b=1E3):b=a-this.secondTickInterval;1E3<=b&&(this.secondTickInterval=timeStamp()-(b-1E3),this.everySecond(b));b=a-this.lasttimestamp;this.lasttimestamp=a;this.accumulator+=b;for(this.stats.begin();this.accumulator>=b&&(this.gameworld.update(b),this.accumulator-=b,0!==b););this.status.update();
this.stats.end();requestAnimFrame(this.update.bind(this))}};Main.prototype.loadSpriteSheet=function(){var a=new PIXI.AssetLoader(["resources/buildings.json"]);a.onComplete=this.spriteSheetLoaded.bind(this);a.load()};
Main.prototype.newWave=function(){this.everySecond=this.everyWaveSecond;this.gameworld&&(this.wave++,this.status.cleanup(),this.gameworld.cleanup(),this.stage.removeChildren());this.gameworld=new GameWorld(this.stage,this.renderer,this);this.status=new Status(this.stage,this,this.gameworld);this.secondTickInterval=this.lasttimestamp=null;this.accumulator=0};
Main.prototype.newIntermission=function(){var a,b,c=0;for(b=0;b<this.gameworld.men.length;b++)"saved"===this.gameworld.men[b].status&&c++;b=Math.floor(Math.floor(50+this.wave/5*5)/100*this.gameworld.men.length);this.everySecond=this.everyIntermissionSecond;this.gameworld&&(a=this.gameworld.men,this.status.cleanup(),this.gameworld.cleanup(),this.stage.removeChildren());c>=b?this.gameworld=new Intermission(this.stage,this.renderer,this,a):(this.gameworld=new GameOver(this.stage,this.renderer,this,a),
this.score=this.wave=0);this.status=new Status(this.stage,this,this.gameworld);this.secondTickInterval=this.lasttimestamp=null;this.accumulator=0};Main.prototype.spriteSheetLoaded=function(){this.newWave();window.onkeydown=this.checkKeyDown.bind(this);window.onkeyup=this.checkKeyUp.bind(this);requestAnimFrame(this.update.bind(this))};Main.prototype.everyIntermissionSecond=function(a){this.gameworld.secondTick(a);this.status.statusTick(a);this.gameworld.status()||this.newWave()};
Main.prototype.everyWaveSecond=function(a){this.gameworld.secondTick(a);this.status.statusTick(a);this.gameworld.status()||this.newIntermission()};Main.prototype.checkKeyUp=function(a){a=window.event?event.keyCode:a.keyCode;Howler.usingWebAudio&&(86==a&&Howler.volume(Howler.volume()+0.1),66==a&&Howler.volume(Howler.volume()-0.1));13===a&&(this.gameworld instanceof Intermission||this.gameworld instanceof GameOver)?this.newWave():this.gameworld.checkKeyUp(a)};
Main.prototype.checkKeyDown=function(a){this.gameworld.checkKeyDown(window.event?event.keyCode:a.keyCode);a.preventDefault()};
