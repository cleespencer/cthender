function GameWorld(a,b,c){this.stage=a;this.renderer=b;this.game=c;this.wave=this.game.wave;this.basedelta=5;this.keyarrs=[];this.city=[];this.ships=[];this.towers=[];this.men=[];this.splodythings=[];this.viewwidth=960;this.viewheight=540;this.worldwidth=GameWorld.WORLDMAX;this.worldheight=540;this.minimap=new MiniMap(a,this,this.viewwidth,this.viewheight);this.keyarrs[13]="enter";this.keyarrs[32]="space";this.keyarrs[37]="left";this.keyarrs[38]="up";this.keyarrs[39]="right";this.keyarrs[40]="down";
this.keyarrs[87]="up";this.keyarrs[83]="down";this.keyarrs[65]="left";this.keyarrs[68]="right";this.particlesystem=new PARTSYS.ParticleSystem;this.scroller=new Scroller(this.stage);this.moon=new MoonObject("moon.png",72,72,GameWorld.WORLDMAX,540,960,540,Math.floor(GameWorld.WORLDMAX/2),50);this.stage.addChild(this.moon);this.cthlugs=[];this.buildCity();this.player=new PlayerObject(this.stage,this.particlesystem,GameWorld.WORLDMAX,540,960,540,254);this.stage.addChild(this.player);this.camerax=0;this.maxcthortals=
Math.ceil(this.wave/3);this.maxcthortals=Math.min(this.maxcthortals,5);this.cthortals=[];this.maxcthings=5+Math.ceil(this.wave/2);this.maxcthings=Math.min(this.maxcthings,25);this.cthings=[];this.cthombs=[];this.bullets=[];this.backgroundmusic=new BackgroundMusic;this.firstupdate=!0;this.gamepercentage=new PIXI.Text("Rescue "+Math.floor(Math.floor(50+this.wave/5*5)/100*this.men.length)+" men to win...",{font:"20px Play",fill:"white",align:"left"});this.gamepercentage.position.x=480-this.gamepercentage.width/
2;this.gamepercentage.position.y=this.moon.position.y+this.moon.height+5;this.stage.addChild(this.gamepercentage)}GameWorld.constructor=GameWorld;GameWorld.prototype=Object.create(Object.prototype);GameWorld.WORLDMAX=3839;GameWorld.MAXPLAYERFUEL=4;GameWorld.prototype.status=function(){var a;if(!this.men.length)return!0;for(a=0;a<this.ships.length;a++)if(!this.ships[a].shiplaunchcomplete)return!0;return!1};
GameWorld.prototype.cleanup=function(){var a;this.backgroundmusic.stop();this.minimap.cleanup();this.player.cleanup();for(a=0;a<this.cthortals.length;a++)this.cthortals[a].cleanup();for(a=0;a<this.cthings.length;a++)this.cthings[a].cleanup();for(a=0;a<this.cthombs.length;a++)this.cthombs[a].cleanup();for(a=0;a<this.cthlugs.length;a++)this.cthlugs[a].cleanup();for(a=0;a<this.towers.length;a++)this.towers[a].cleanup();for(a=0;a<Howler._howls.length;a++)Howler._howls[a].stop();Howler._howls=[]};
GameWorld.prototype.addTower=function(a){var b;b=new RescueShip(this,this.stage,GameWorld.WORLDMAX,540,960,540,a,316);a+=b.width-78;this.stage.addChild(b);this.ships.push(b);b=new TowerObject(this.stage,this.particlesystem,240,220,GameWorld.WORLDMAX,540,960,540,a,320);a+=240;this.stage.addChild(b);this.towers.push(b);return a};
GameWorld.prototype.buildCity=function(){for(var a=0,b=0,c,d,e,f;a<GameWorld.WORLDMAX-160;)a>0.25*GameWorld.WORLDMAX&&0===b&&(a=this.addTower(a),b=1),a>0.75*GameWorld.WORLDMAX&&1===b&&(a=this.addTower(a),b=2),0.75>Math.random()?(d=Math.ceil(3*Math.random())-1,c=0===d?new BuildingObject("building03x1.png",80,156,GameWorld.WORLDMAX,540,960,540,a,384):1===d?new BuildingObject("building02x1.png",80,188,GameWorld.WORLDMAX,540,960,540,a,352):new BuildingObject("building01x2.png",160,125,GameWorld.WORLDMAX,
540,960,540,a,415),a=0===d||1===d?a+80:a+160,0.25>Math.random()&&(e=c.worldx+Math.floor(c.width/2)-6,f=c.worldy-24,d=new ManObject(this,GameWorld.WORLDMAX,540,960,540,e,f),e=new ManFlying(GameWorld.WORLDMAX,540,960,540,e,f),this.stage.addChild(d),this.stage.addChild(e),this.men.push({sprite:d,flyingsprite:e,status:"standing",fallheight:null})),this.stage.addChild(c),this.city.push(c)):a+=80};
GameWorld.prototype.fireWeapon=function(a){this.player instanceof ExplodyShip||2<this.bullets.length||(this.bullets.push(new WeaponLaser(this.stage,this.particlesystem,this.bulletDead.bind(this),GameWorld.WORLDMAX,540,960,540,this.player.worldx,this.player.worldy,this.player.olddirection,this.camerax)),(new Howl({urls:["resources/sounds/science_fiction_phaser_gun.mp3"],volume:1})).play())};
GameWorld.prototype.bulletDead=function(a){var b,c;for(b=this.bullets.length-1;0<=b;b--)if(c=this.bullets[b],c===a){this.bullets.splice(b,1);break}};GameWorld.prototype.checkKeyUp=function(a){"left"!==this.keyarrs[a]&&"right"!==this.keyarrs[a]&&"space"!==this.keyarrs[a]&&"down"!==this.keyarrs[a]&&"up"!==this.keyarrs[a]||this.player.keyreleased(this.keyarrs[a])};
GameWorld.prototype.checkKeyDown=function(a){"left"!==this.keyarrs[a]&&"right"!==this.keyarrs[a]&&"enter"!==this.keyarrs[a]&&"down"!==this.keyarrs[a]&&"up"!==this.keyarrs[a]||this.player.keypressed(this.keyarrs[a]);"space"===this.keyarrs[a]&&this.fireWeapon(a)};
GameWorld.prototype.secondTick=function(a){var b;this.player.everySecond(a);for(b=0;b<this.towers.length;b++)this.towers[b].everySecond(a);for(b=0;b<this.city.length;b++)this.city[b].everySecond(a);for(b=0;b<this.men.length;b++)this.men[b].sprite.everySecond(a);for(b=0;b<this.cthortals.length;b++)this.cthortals[b].everySecond(a);for(b=0;b<this.cthings.length;b++)this.cthings[b].everySecond(a);for(b=0;b<this.cthombs.length;b++)this.cthombs[b].everySecond(a);for(b=0;b<this.cthlugs.length;b++)this.cthlugs[b].everySecond(a);
for(b=0;b<this.ships.length;b++)this.ships[b].everySecond(a);this.ships[0].shiptakeoff||this.cthortalTick(a);this.endGameTick(a)};GameWorld.prototype.endGameTick=function(a){var b,c=!1;for(b=0;b<this.men.length;b++)if(a=this.men[b].status,"dead"!==a&&"saved"!==a){c=!0;break}if(!c)for(b=0;b<this.ships.length;b++)if(!this.ships[b].isClear()){c=!0;break}if(!c){for(b=0;b<this.ships.length;b++)this.ships[b].takeoff();for(b=this.cthings.length-1;0<=b;b--)this.removeCthing(b)}};
GameWorld.prototype.birthCthomb=function(a,b){var c=new Cthomb(this,this.stage,GameWorld.WORLDMAX,540,960,540,a,b);this.cthombs.push(c);this.stage.addChild(c)};GameWorld.prototype.birthCthlug=function(a,b){var c=new Cthlug(this,this.stage,GameWorld.WORLDMAX,540,960,540,a,b);this.cthlugs.push(c);this.stage.addChild(c)};
GameWorld.prototype.cthortalTick=function(a){var b,c,d;0===this.cthortals.length?d=1:(d=1-this.cthortals.length/this.maxcthortals,d=Math.pow(d,1.9));Math.random()<d&&(b=Math.floor(Math.random()*GameWorld.WORLDMAX),c=Math.floor(298*Math.random())+32,(new Howl({urls:["resources/sounds/cthortal_open.mp3"],volume:1})).play(),this.cthortals.push(new Cthortal(this.stage,this.particlesystem,GameWorld.WORLDMAX,540,960,540,b,c)));for(a=this.cthortals.length-1;0<=a;a--)c=this.cthortals[a],"dead"===c.status&&
(c.cleanup(),this.cthortals.splice(a,1)),0.05>Math.random()&&"living"===c.status&&((new Howl({urls:["resources/sounds/cthortal_close.mp3"],volume:1})).play(),c.status="dying"),0===this.cthings.length?d=1:(d=1-this.cthings.length/this.maxcthings,d=Math.pow(d,1.9)),0===this.maxcthings&&(d=0),Math.random()<d&&"living"===c.status&&(b=c.worldx-32,0>b&&(b=this.WORLDMAX+b),c=c.worldy-32,5>this.wave?b=new Cthing(this,this.stage,GameWorld.WORLDMAX,540,960,540,b,c):5<=this.wave&&10>this.wave?b=0.75>Math.random()?
new Cthing(this,this.stage,GameWorld.WORLDMAX,540,960,540,b,c):new Cthod(this,this.stage,GameWorld.WORLDMAX,540,960,540,b,c):(d=Math.random(),b=0.65>d?new Cthing(this,this.stage,GameWorld.WORLDMAX,540,960,540,b,c):0.65<=d&&0.9>d?new Cthod(this,this.stage,GameWorld.WORLDMAX,540,960,540,b,c):new Cthomber(this,this.stage,GameWorld.WORLDMAX,540,960,540,b,c)),b&&((new Howl({urls:["resources/sounds/cthing_born.mp3"],volume:1})).play(),this.cthings.push(b),this.stage.addChild(b)))};
GameWorld.prototype.update=function(a){var b,c,d;this.gamepercentage.alpha-=0.005;0>this.gamepercentage.alpha&&(this.gamepercentage.alpha=0);this.firstupdate&&(this.backgroundmusic.next(),this.firstupdate=!1);c=this.player.playerdirection*(this.player.thrusters?this.basedelta*this.player.playerfuel:this.basedelta)*a*60/1E3;this.camerax+=c;this.camerax>GameWorld.WORLDMAX&&(this.camerax-=GameWorld.WORLDMAX+1);0>this.camerax&&(this.camerax+=GameWorld.WORLDMAX+1);for(b=0;b<this.bullets.length;b++)this.bullets[b].update(this.camerax,
a);for(b=0;b<this.city.length;b++)this.city[b].update(this.camerax);for(b=0;b<this.ships.length;b++)this.ships[b].update(this.camerax,a);for(b=0;b<this.towers.length;b++)this.towers[b].update(this.camerax);for(b=0;b<this.men.length;b++)d=this.men[b],"dead"!==d.manstate&&"saved"!==d.manstate&&(d.sprite.update(this.camerax,d,this.player,a),d.flyingsprite.update(this.camerax,d,this.player),"flying"===d.status?d.sprite.visible=!1:d.flyingsprite.visible=!1);for(b=0;b<this.splodythings.length;b++)this.splodythings[b].update(this.camerax);
for(b=0;b<this.cthortals.length;b++)this.cthortals[b].update(this.camerax);for(b=0;b<this.cthings.length;b++)this.cthings[b].update(this.camerax,a);for(b=this.cthombs.length-1;0<=b;b--)this.cthombs[b].dead?(this.stage.removeChild(this.cthombs[b]),this.birthCthlug(this.cthombs[b].worldx,this.cthombs[b].worldy+12),this.cthombs[b].cleanup(),this.cthombs.splice(b,1)):this.cthombs[b].update(this.camerax,a);for(b=this.cthlugs.length-1;0<=b;b--)this.cthlugs[b].dead?(this.stage.removeChild(this.cthlugs[b]),
this.cthlugs[b].cleanup(),this.cthlugs.splice(b,1)):this.cthlugs[b].update(this.camerax,a);this.moon.update(this.camerax);this.scroller.moveViewportXBy(c,a);this.player.update(this.camerax,c,a);this.collision();this.particlesystem.update(a);this.minimap.update(this.camerax);this.renderer.render(this.stage)};GameWorld.prototype.respawnPlayer=function(){this.camerax=0;this.player=new PlayerObject(this.stage,this.particlesystem,GameWorld.WORLDMAX,540,960,540,254);this.stage.addChild(this.player)};
GameWorld.prototype.removeSplody=function(a){a=this.splodythings.indexOf(a);-1!==a&&this.splodythings.splice(a,1)};GameWorld.prototype.removeCthlug=function(a){a=this.cthlugs.splice(a,1)[0];a.cleanup();this.stage.removeChild(a);a=new ExplodyCthing(this.stage,this.particlesystem,!1,GameWorld.WORLDMAX,540,960,540,a.worldx,a.worldy,this.camerax);(new Howl({urls:["resources/sounds/cthquish.mp3"],volume:1})).play();a.onDone=this.removeSplody.bind(this);this.splodythings.push(a)};
GameWorld.prototype.removeCthing=function(a){a=this.cthings.splice(a,1)[0];a.manattached&&(a.manattached.status="falling",a.manattached.fallheight=a.worldy+64);a.cleanup();this.stage.removeChild(a);a=new ExplodyCthing(this.stage,this.particlesystem,a.muto,GameWorld.WORLDMAX,540,960,540,a.worldx,a.worldy,this.camerax);(new Howl({urls:["resources/sounds/cthquish.mp3"],volume:1})).play();a.onDone=this.removeSplody.bind(this);this.splodythings.push(a)};
GameWorld.prototype.playerBlooie=function(a){a=a||!1;var b=this.player.worldx,c=this.player.worldy;this.game.score-=250;0>this.game.score&&(this.game.score=0);this.player.cleanup();this.stage.removeChild(this.player);this.player.manattached&&(a?this.manBlooie(this.player.manattached):(this.player.manattached.status="falling",this.player.manattached.fallheight=this.player.worldy+this.player.height));this.player=new ExplodyShip(this.stage,this.particlesystem,this.player.playerdirection,GameWorld.WORLDMAX,
540,960,540,b,c,this.camerax);(new Howl({urls:["resources/sounds/explosion_3.mp3"],volume:1})).play();this.player.onDone=this.respawnPlayer.bind(this)};GameWorld.prototype.manBlooie=function(a){this.game.score-=500;0>this.game.score&&(this.game.score=0);a.status="dead";a.sprite.visible=!1;a=new ExplodyMan(this.stage,GameWorld.WORLDMAX,540,960,540,a.sprite.worldx,a.sprite.worldy);(new Howl({urls:["resources/sounds/screamdie.mp3"],volume:1})).play();a.onDone=this.removeSplody.bind(this);this.splodythings.push(a)};
GameWorld.prototype.manSaved=function(a,b){a.status="saved";a.sprite.visible=!1;this.game.score+=500;this.ships[b].addMan()};
GameWorld.prototype.isCollidedFragment=function(a,b){var c,d,e,f,g,h,k,l;if(a.worldx+a.width>GameWorld.WORLDMAX&&b.worldx+b.width>GameWorld.WORLDMAX&&(c=a.worldx,d=GameWorld.WORLDMAX-a.worldx,e=0,f=a.width-d,g=b.worldx,h=GameWorld.WORLDMAX-b.worldx,k=0,l=b.width-h,a.worldx<g+h&&a.worldx+a.width>g&&a.worldy<b.worldy+b.height&&a.worldy+a.height>b.worldy||a.worldx<k+l&&a.worldx+a.width>k&&a.worldy<b.worldy+b.height&&a.worldy+a.height>b.worldy||b.worldx<c+d&&b.worldx+b.width>c&&b.worldy<a.worldy+a.height&&
b.worldy+b.height>a.worldy||b.worldx<e+f&&b.worldx+b.width>e&&b.worldy<a.worldy+a.height&&b.worldy+b.height>a.worldy))return!0;if(a.worldx+a.width<=GameWorld.WORLDMAX)return g=b.worldx,h=GameWorld.WORLDMAX-b.worldx,k=0,l=b.width-h,a.worldx<g+h&&a.worldx+a.width>g&&a.worldy<b.worldy+b.height&&a.worldy+a.height>b.worldy||a.worldx<k+l&&a.worldx+a.width>k&&a.worldy<b.worldy+b.height&&a.worldy+a.height>b.worldy?!0:!1;if(a.worldx+a.width>GameWorld.WORLDMAX)return c=a.worldx,d=GameWorld.WORLDMAX-a.worldx,
e=0,f=a.width-d,b.worldx<c+d&&b.worldx+b.width>c&&b.worldy<a.worldy+a.height&&b.worldy+b.height>a.worldy||b.worldx<e+f&&b.worldx+b.width>e&&b.worldy<a.worldy+a.height&&b.worldy+b.height>a.worldy?!0:!1;console.log("Should never get here.");return!1};
GameWorld.prototype.isCollided=function(a,b,c){return a instanceof ExplodyShip||b instanceof ExplodyShip||c&&(!a.visible||!b.visible)?!1:a.worldx+a.width>GameWorld.WORLDMAX||b.worldx+b.width>GameWorld.WORLDMAX?this.isCollidedFragment(a,b):a.worldx<b.worldx+b.width&&a.worldx+a.width>b.worldx&&a.worldy<b.worldy+b.height&&a.worldy+a.height>b.worldy?!0:!1};
GameWorld.prototype.isCollidedPoint=function(a,b,c,d){var e,f;if(!d||a.visible)return a.worldx+a.width>GameWorld.WORLDMAX?(d=a.worldx,e=GameWorld.WORLDMAX-a.worldx,f=a.width-e,b>=d&&b<=d+e&&c>=a.worldy&&c<=a.worldy+a.height||0<=b&&b<=0+f&&c>=a.worldy&&c<=a.worldy+a.height?!0:!1):b>=a.worldx&&b<=a.worldx+a.width&&c>=a.worldy&&c<=a.worldy+a.height?!0:!1};GameWorld.prototype.isCollidedCoords=function(a,b,c,d,e,f){return this.isCollided(a,{worldx:b,worldy:c,visible:!0,width:d,height:e},f)};
GameWorld.prototype.collideplayer=function(){if(!this.player.invincible){var a,b,c;for(a=0;a<this.city.length;a++)b=this.city[a],this.isCollided(b,this.player,!0)&&this.playerBlooie(!0);for(a=0;a<this.cthings.length;a++){c=this.cthings[a];if(this.isCollided(c,this.player,!0)){this.playerBlooie(!1);this.removeCthing(a);break}if(c instanceof Cthod)for(b=0;b<c.cthlies.length;b++)if(this.isCollided(c.cthlies[b],this.player,!0)){this.playerBlooie(!1);c.removeCthly(b);break}}}};
GameWorld.prototype.testcollidetowertractor=function(a){var b,c,d;d="flying"===a.status?a.flyingsprite:a.sprite;for(b=0;b<this.towers.length;b++)c=this.towers[b],this.isCollidedCoords(d,c.worldx+20,c.worldy-55,c.width-40,55)&&(a.status="saving",this.player.manattached=null)};GameWorld.prototype.testcollidetower=function(a){var b,c;for(b=0;b<this.towers.length;b++)c=this.towers[b],this.isCollided(a.sprite,c)&&this.manSaved(a,b)};
GameWorld.prototype.testcollidebuilding=function(a){var b,c,d,e=a.fallheight||9E3;if(a.sprite.y>540-a.sprite.height)this.manBlooie(a);else for(b=0;b<this.city.length;b++)if(c=this.city[b],this.isCollided(a.sprite,c,!1)){d=Math.abs(e-c.worldy);if(d>3*a.sprite.height){this.manBlooie(a);break}a.status="standing";a.fallheight=null;a.sprite.worldy=c.worldy-24}};
GameWorld.prototype.testcollidetractor=function(a){return this.player instanceof PlayerObject&&!this.player.manattached&&this.isCollidedCoords(a.sprite,this.player.worldx+17,this.player.worldy,50,50+this.player.height,!0)?"standing"===a.status||"ascending"===a.status?(a.status="ascending",this.player.tractor=a.sprite.worldy-this.player.worldy-this.player.height,!0):!1:!1};
GameWorld.prototype.testcollideship=function(a){if(!(this.player instanceof PlayerObject)||this.player.manattached&&"flying"===a.status||!this.isCollided(a.sprite,this.player,!0))return!1;if(!this.player.manattached)return this.player.manattached=a,a.status="flying",!1;this.manBlooie(a);return!0};
GameWorld.prototype.testcollidecthing=function(a){var b,c;for(b=0;b<this.cthings.length;b++)if(c=this.cthings[b],!(c instanceof Cthod||c instanceof Cthomber)&&this.isCollidedCoords(a.sprite,c.worldx+26,c.worldy+48,12,16))return a.status="flailing",c.attachMan(a),(new Howl({urls:["resources/sounds/hesgotme.mp3"],volume:1})).play(),!0;return!1};
GameWorld.prototype.testcollidecthomb=function(a){var b,c,d=!1;for(b=0;b<this.cthombs.length;b++)if(c=this.cthombs[b],this.isCollided(c,a.sprite,!1)){d=!0;break}d&&this.manBlooie(a);return d};GameWorld.prototype.testcollidecthlug=function(a){var b,c,d=!1;for(b=0;b<this.cthlugs.length;b++)if(c=this.cthlugs[b],this.isCollided(c,a.sprite,!1)){d=!0;break}d&&this.manBlooie(a);return d};
GameWorld.prototype.collideman=function(){var a,b,c;for(a=0;a<this.men.length;a++)b=this.men[a],"dead"!==b.status&&"saved"!==b.status&&"flailing"!==b.status&&("saving"===b.status?this.testcollidetower(b):"standing"===b.status||"ascending"===b.status?(c=this.testcollideship(b),c||(c=this.testcollidetractor(b),!1===c&&"ascending"===b.status&&(b.status="falling",b.fallheight=b.sprite.worldy),this.testcollidecthing(b),this.testcollidecthomb(b),this.testcollidecthlug(b))):"falling"===b.status?(this.testcollideship(b),
this.testcollidebuilding(b),this.testcollidetowertractor(b),this.testcollidecthing(b)):"flying"===b.status&&(this.player instanceof PlayerObject?this.testcollidetowertractor(b):(b.status="falling",b.fallheight=b.sprite.worldy)))};
GameWorld.prototype.collidebullets=function(){var a,b,c,d;for(a=this.bullets.length-1;0<=a;a--){for(b=this.cthings.length-1;0<=b;b--){if(this.isCollided(this.bullets[a],this.cthings[b],!1)){this.removeCthing(b);this.bullets[a].cleanup();return}if(this.cthings[b]instanceof Cthod)for(c=this.cthings[b].cthlies.length-1;0<=c;c--)if(d=this.cthings[b].cthlies[c],this.isCollided(this.bullets[a],d,!1)){this.cthings[b].removeCthly(c);this.bullets[a].cleanup();return}}for(b=this.cthlugs.length-1;0<=b;b--)if(this.isCollided(this.bullets[a],
this.cthlugs[b],!1)){this.removeCthlug(b);this.bullets[a].cleanup();return}}};GameWorld.prototype.collision=function(){this.collideplayer();this.player.tractor=!1;this.collideman();this.collidebullets()};
