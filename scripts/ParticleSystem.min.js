(function(){var c=c||{};c.version="v0.0.2";c.pix2=2*Math.PI;c.pidiv180=180/Math.PI;c.framerate=0.06;c.distance=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))};c.distance2=function(a,b){return Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)};c.degreesToRadians=function(a){return a*Math.PI/180};c.radiansToDegrees=function(a){return a*c.pidiv180};c.sleep=function(a,b){setTimeout(b,a)};c.Vector=function(a,b){this.x=a||0;this.y=b||0};c.Vector.constructor=c.Vector;c.Vector.prototype=Object.create(Object.prototype);
c.Vector.prototype.selfAdd=function(a){this.x+=a.x;this.y+=a.y};c.Vector.prototype.selfSubtract=function(a){this.x-=a.x;this.y-=a.y};c.Vector.prototype.selfMultiply=function(a){this.x*=a.x;this.y*=a.y};c.Vector.prototype.selfDivide=function(a){this.x/=a.x;this.y/=a.y};c.Vector.prototype.add=function(a){return new c.Vector(this.x+a.x,this.y+a.y)};c.Vector.prototype.subtract=function(a){return new c.Vector(this.x-a.x,this.y-a.y)};c.Vector.prototype.multiply=function(a){return new c.Vector(this.x*a.x,
this.y*a.y)};c.Vector.prototype.divide=function(a){return new c.Vector(this.x/a.x,this.y/a.y)};c.Vector.prototype.multiplyScale=function(a){return new c.Vector(this.x*a,this.y*a)};c.Vector.prototype.divideScale=function(a){return new c.Vector(this.x/a,this.y/a)};c.Vector.prototype.normalize=function(){var a=this.getMagnitude();this.x*=1/a;this.y*=1/a};c.Vector.prototype.unit=function(){var a=this.getMagnitude();return new c.Vector(1/a*this.x,1/a*this.y)};c.Vector.prototype.leftNormal=function(a){return new c.Vector(a.y,
-a.x)};c.Vector.prototype.rightNormal=function(a){return new c.Vector(-a.y,a.x)};c.Vector.prototype.dot=function(a){return this.x*a.x+this.y*a.y};c.Vector.prototype.rotate=function(a){var b=this.x,c=this.y;this.x=b*cos(a)-c*sin(a);this.y=b*sin(a)+c*cos(a)};c.Vector.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};c.Vector.prototype.getAngle=function(){return Math.atan2(this.y,this.x)};c.Vector.fromAngle=function(a,b){return new c.Vector(b*Math.cos(a),b*Math.sin(a))};
c.ParticleSystem=function(a){this.element=a;this.emitters=[];this.fields=[];this.onEmitterUpdate=this.onCreateEmitter=null};c.ParticleSystem.constructor=c.ParticleSystem;c.ParticleSystem.prototype.getEmitterNames=function(){var a,b=[];for(a=0;a<this.emitters.length;a++)b.push(this.emitters[a].emittername);return b};c.ParticleSystem.prototype.getFieldNames=function(){var a,b=[];for(a=0;a<this.fields.length;a++)b.push(this.fields[a].fieldname);return b};c.ParticleSystem.prototype.getEmitter=function(a){var b;
for(b=0;b<this.emitters.length;b++)if(this.emitters[b].emittername===a)return this.emitters[b].emitterobj;return null};c.ParticleSystem.prototype.addEmitter=function(a,b){var e;a=a||"";b=b||new c.Emitter;b.element=this.element;for(e=0;e<this.emitters.length;e++)if(this.emitters[e].emittername===a)return;this.emitters.push({emittername:a,emitterobj:b});if(this.onCreateEmitter)this.onCreateEmitter(b)};c.ParticleSystem.prototype.removeEmitter=function(a){var b;for(b=this.emitters.length-1;0<=b;b--)if(this.emitters[b].emittername===
a){this.emitters[b].emitterobj.cleanup();this.emitters.splice(b,1);break}};c.ParticleSystem.prototype.addField=function(a,b){a=a||"";b=b||new c.Field;var e;for(e=0;e<this.fields.length;e++)if(this.fields[e].fieldname===a)return;this.fields.push({fieldname:a,fieldobj:b})};c.ParticleSystem.prototype.removeField=function(a){var b;for(b=this.fields.length-1;0<=b;b--)if(this.fields[b].fieldname===a){this.fields.splice(b,1);break}};c.ParticleSystem.prototype.moveEmitter=function(a,b,e){var d,f,h,g;for(d=
0;d<this.emitters.length;d++)if(this.emitters[d].emittername===a){a=this.emitters[d].emitterobj;f=b-a.x;h=e-a.y;a.lockbounded&&a.bounded&&(a.bounded.x+=f,a.bounded.y+=h);if(a.lockfields&&a.emitterfields)for(d=0;d<a.emitterfields.length;d++)g=a.emitterfields[d],g.x+=f,g.y+=h;if(a.lockparticles)for(f=new c.Vector(f,h),d=0;d<a.particles.length;d++)a.particles[d].position.selfAdd(f);else a.particles=[];a.x=b;a.y=e;break}};c.ParticleSystem.prototype.moveField=function(a,b,c){var d;for(d=0;d<this.fields.length;d++)if(this.fields[d].fieldname===
a){this.fields[d].fieldobj.x=b||this.fields[d].fieldobj.x;this.fields[d].fieldobj.y=c||this.fields[d].fieldobj.y;break}};c.ParticleSystem.prototype.update=function(a){var b,c=[];a=a||null;for(b=0;b<this.fields.length;b++)c.push(this.fields[b].fieldobj);for(b=0;b<this.emitters.length;b++){if(this.onEmitterUpdate)this.onEmitterUpdate(this.emitters[b].emitterobj);this.emitters[b].emitterobj.update(c,a)}for(b=this.emitters.length-1;0<=b;b--)this.emitters[b].emitterobj.dead&&(this.emitters[b].emitterobj.cleanup(),
this.emitters.splice(b,1))};c.Particle=function(a,b,c,d){this.set(a,b,c,d)};c.Particle.constructor=c.Particle;c.Particle.prototype.set=function(a,b,e,d){this.position=a||new c.Vector(0,0);this.velocity=b||new c.Vector(0,0);this.lifetime=e||0;this.rotation=d||0;this.oldposition=new c.Vector(this.position.x,this.position.y);this.age=0;this.dead=!1;this.angle=Math.floor(360*Math.random());this.color=this.textures=this.sprite=null};c.Particle.prototype.update=function(a){a=a||null;this.age+=1;this.lifetime&&
this.age>=this.lifetime&&(this.dead=!0);this.rotation&&(this.angle=a?this.angle+this.rotation*a*c.framerate:this.angle+this.rotation,359<this.angle&&(this.angle-=360),0>this.angle&&(this.angle=360+this.angle));this.oldposition.x=this.position.x;this.oldposition.y=this.position.y;a?(a=new c.Vector(this.velocity.x*a*c.framerate,this.velocity.y*a*c.framerate),this.position.selfAdd(a)):this.position.selfAdd(this.velocity)};c.Emitter=function(a,b,c,d,f,h,g,k,l,m,n,p,q,r,s,t){this.x=a||0;this.y=b||0;this.area=
c||{xanchor:0.5,yanchor:0.5,width:1,height:1,radius:0};this.density=d||{min:1,max:1};this.angle=f||{min:350,max:10};this.speed=h||{min:1,max:1};this.rotation=g||0;this.particlerotation=k||{min:0,max:0};this.lifetime=l||{min:0,max:0};this.bounded=m||{x:0,y:0,width:window.innerWidth,height:window.innerHeight,type:"die"};this.emitterfields=n||null;this.lockbounded=p||!0;this.lockfields=q||!1;this.lockparticles=r||!1;this.dienoparticles=s||!1;this.maxparticles=t||0;this.particles=[];this.reuse=[];this.firstupdate=
!0;this.dead=!1;this.numparticles=0;this.render=!0;this.onCleanup=this.onCustomBounds=this.onRemoveParticle=this.onUpdateParticles=this.onTransformParticles=this.onCreateParticle=null};c.Emitter.prototype.constructor=c.Emitter;c.Emitter.prototype.update=function(a,b){var c,d,f;b=b||null;f=this.emitterfields?a.concat(this.emitterfields):a;this.createParticles();for(c=this.particles.length-1;0<=c;c--)d=this.particles[c],this.moveParticle(d,f,b),d.dead&&(this.removeParticle(d),this.reuse.push(this.particles.splice(c,
1)));this.firstupdate?this.firstupdate=!1:0===this.particles.length&&this.dienoparticles&&(this.dead=!0);this.dead||(this.transformParticles(),this.render&&this.updateParticles())};c.Emitter.prototype.collider=function(a){var b,e,d;if(this.bounded&&(a.position.x<=this.bounded.x||a.position.y<=this.bounded.y||a.position.x>=this.bounded.x+this.bounded.width||a.position.y>=this.bounded.y+this.bounded.height))switch(this.bounded.type){case "bounce":d=new c.Vector(a.velocity.x,a.velocity.y);a.position.x<
this.bounded.x?(d.x=-a.velocity.x,b=new c.Vector(0,this.bounded.y+this.bounded.height),b=b.leftNormal(b).unit()):a.position.x>this.bounded.x+this.bounded.width&&(d.x=-a.velocity.x,b=new c.Vector(0,this.bounded.y+this.bounded.height),b=b.rightNormal(b).unit());a.position.y<this.bounded.y?(d.y=-a.velocity.y,b=new c.Vector(this.bounded.x+this.bounded.width,0),b=b.rightNormal(b).unit()):a.position.y>this.bounded.y+this.bounded.height&&(d.y=-a.velocity.y,b=new c.Vector(this.bounded.x+this.bounded.width,
0),b=b.leftNormal(b).unit());b=b.multiplyScale(a.velocity.dot(b));e=a.velocity.subtract(b);a.position=a.oldposition.add(e.subtract(b));a.velocity=d;break;case "wrap":a.position.x<this.bounded.x?a.position.x=this.bounded.x+this.bounded.width:a.position.x>this.bounded.x+this.bounded.width&&(a.position.x=this.bounded.x);a.position.y<this.bounded.y?a.position.y=this.bounded.y+this.bounded.height:a.position.y>this.bounded.y+this.bounded.height&&(a.position.y=this.bounded.y);break;case "stop":a.position=
a.oldposition;break;case "custom":this.onCustomBounds(a);break;case "die":a.dead=!0}};c.Emitter.prototype.moveParticle=function(a,b,c){var d;c=c||null;for(d=0;d<b.length;d++)b[d].update(a,c);a.update(c);this.collider(a)};c.Emitter.prototype.getNewParticle=function(a){var b,e,d,f=0;this.rotation&&(this.angle.min+=this.rotation,this.angle.max+=this.rotation,0>this.angle.min&&(this.angle.min=360+this.angle.min),359<this.angle.min&&(this.angle.min-=360),0>this.angle.max&&(this.angle.max=360+this.angle.max),
359<this.angle.max&&(this.angle.max-=360));b=this.angle.min>this.angle.max?360-this.angle.min+this.angle.max:this.angle.max-this.angle.min;b=Math.random()*b+this.angle.min;359<b&&(b-=360);b=c.degreesToRadians(b);e=Math.random()*(this.speed.max-this.speed.min)+this.speed.min;e=(new c.Vector(e,e)).getMagnitude();e=c.Vector.fromAngle(b,e);d=Math.random()*this.lifetime.max-this.lifetime.min+this.lifetime.min;if(this.particlerotation.min||this.particlerotation.max)f=Math.floor(Math.random()*Math.abs(this.particlerotation.max-
this.particlerotation.min)+this.particlerotation.min);this.reuse.length?(b=this.reuse.pop()[0],b.set(a,e,d,f)):b=new c.Particle(a,e,d,f);return b};c.Emitter.prototype.getNewParticleRadius=function(){var a;a=Math.random()*c.pix2;a=new c.Vector(Math.cos(a)*this.area.radius+this.x,Math.sin(a)*this.area.radius+this.y);return this.getNewParticle(a)};c.Emitter.prototype.getNewParticleRect=function(){var a,b;b=this.x-this.area.xanchor*this.area.width;a=this.y-this.area.yanchor*this.area.height;b=Math.random()*
this.area.width+b;a=Math.random()*this.area.height+a;a=new c.Vector(b,a);return this.getNewParticle(a)};c.Emitter.prototype.createParticles=function(){if(!(this.numparticles>=this.maxparticles&&this.maxparticles)){var a=Math.floor(Math.random()*(this.density.max-this.density.min))+this.density.min;this.numparticles+a>this.maxparticles&&this.maxparticles&&(a=this.maxparticles-this.numparticles);this.numparticles+=a;var b,c;for(b=0;b<a;b++)if(c=0<this.area.radius?this.getNewParticleRadius():this.getNewParticleRect(),
this.particles.push(c),this.onCreateParticle)this.onCreateParticle(c)}};c.Emitter.prototype.transformParticles=function(){if(this.onTransformParticles)this.onTransformParticles(this.particles)};c.Emitter.prototype.updateParticles=function(){if(this.onUpdateParticles)this.onUpdateParticles(this,this.particles)};c.Emitter.prototype.removeParticle=function(a){if(this.onRemoveParticle)this.onRemoveParticle(a)};c.Emitter.prototype.cleanup=function(){for(var a=0;a<this.particles.length;a++)this.removeParticle(this.particles[a]);
if(this.onCleanup)this.onCleanup(this);this.particles=[];this.reuse=[]};c.Field=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0;this.onFieldInfluenced=null};c.Field.prototype.constructor=c.Field;c.Field.prototype.update=function(a,b){if(a.position.x>this.x&&a.position.x<this.x+this.width&&a.position.y>this.y&&a.position.y<this.y+this.height&&this.onFieldInfluenced)this.onFieldInfluenced(a,this,b||null)};this.PARTSYS=c}).call(this);
