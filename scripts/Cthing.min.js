function Cthing(a,b,c,e,d,f,g,h){this.world=a;this.stage=b;this.worldwidth=c;this.worldheight=e;this.viewwidth=d;this.viewheight=f;this.worldx=g;this.worldy=h;this.manattached=null;this.muto=!1;PIXI.DisplayObjectContainer.call(this);this.textures=["alien1.png","alien2.png","alien3.png","alien4.png"];this.textures_capture=["alien1_capture.png","alien2_capture.png","alien3_capture.png","alien4_capture.png"];this.textureincrement=0;this.texturevector=1;this.height=this.width=64;this.soundstate="stop";
this.deltav=new PARTSYS.Vector(0,0);a=PIXI.Texture.fromFrame("eyeball.png");this.eyeball=new PIXI.Sprite(a,a.width,a.height);this.eyeball.position.x=10;this.eyeball.position.y=12;this.eyeball.visible=!1;this.eyeballfloat=new PARTSYS.Vector(0,0);a=PIXI.Texture.fromFrame("alien1.png");this.alien=new PIXI.Sprite(a,a.width,a.height);this.alien.position.x=0;this.alien.position.y=0;this.alien.visible=!1;this.addChild(this.eyeball);this.addChild(this.alien);this.cthingsoundplaying=!1;this.cthingsound=new Howl({urls:["resources/sounds/cthing_move.mp3"],
onend:function(){this.cthingsoundplaying=!1}.bind(this)});this.timeoutID=setTimeout(this.updateTexture.bind(this),160)}Cthing.constructor=Cthing;Cthing.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);Cthing.prototype.cleanup=function(){this.timeoutID&&clearTimeout(this.timeoutID);this.cthingsound.stop();this.removeChild(this.alien);this.removeChild(this.eyeball)};
Cthing.prototype.attachMan=function(a){this.manattached=a;this.eyeballfloat.x=0;this.eyeballfloat.y=-0.1;this.eyeball.position.x=10;this.deltav.x=0;this.deltav.y=-1};Cthing.prototype.tracking=function(a,b){b=b||{x:this.worldx,y:this.worldy};var c=a.worldx,e;e=c>b.x?Math.abs(b.x+this.worldwidth-c):b.x-c;c=c<b.x?Math.abs(this.worldwidth-b.x+c):c-b.x;return e<c?-1:e>c?1:0};
Cthing.prototype.getClosestManDelta=function(){var a,b,c,e={x:this.worldx+26,y:this.worldy+48},d=null,f=null;this.world.player?(f=PARTSYS.distance2(e,{x:this.world.player.worldx,y:this.world.player.worldy}),d=this.world.player):(f=90001,d=null);for(a=b=a=0;a<this.world.men.length;a++)b=this.world.men[a].status,"standing"===b&&(b=this.world.men[a].sprite,c={x:b.worldx,y:b.worldy},c=PARTSYS.distance2(e,c),c<f&&(d=b,f=c));if(null===d)return{dx:0,dy:0};a=this.tracking(d,e);b=e.y>d.worldy?-1:e.y<d.worldy?
1:0;return{dx:a,dy:b}};Cthing.prototype.everySecondNormal=function(a){var b,c;this.manattached||(a=0===this.deltav.x&&0===this.deltav.y?1:0.75,Math.random()<a&&(a=Math.random(),b=Math.random(),c=this.getClosestManDelta(),this.deltav.x=c.dx,this.deltav.y=c.dy,0.5<a||0.5<b?(this.deltav.x=c.dx,this.deltav.y=c.dy):(0.17>a?this.deltav.x=-1:0.34>a?this.deltav.x=1:0.51>a&&(this.deltav.x=0),0.17>b?this.deltav.y=-1:0.34>b?this.deltav.y=1:0.51>b&&(this.deltav.y=0))))};
Cthing.prototype.everySecondMuto=function(a){var b;a=this.world.player.worldy;b=this.tracking(this.world.player);0.95>Math.random()?(-1===b?(this.eyeballfloat.x=-0.5,this.deltav.x=-3):1===b?(this.eyeballfloat.x=0.5,this.deltav.x=3):this.deltav.x=0,a<this.worldy&&(this.eyeballfloat.y=-0.5,this.deltav.y=-3),a>this.worldy&&(this.eyeballfloat.y=0.5,this.deltav.y=3)):(a=Math.random(),b=Math.random(),0.33>a?(this.eyeballfloat.x=-0.3,this.deltav.x=-3):0.66>a?(this.eyeballfloat.x=0<this.deltav.x?-0.3:0>this.deltav.x?
0.3:0,this.deltav.x=0):(this.eyeballfloat.x=0.3,this.deltav.x=3),0.33>b?(this.eyeballfloat.y=-0.3,this.deltav.y=-3):0.66>b?(this.eyeballfloat.y=0<this.deltav.y?-0.3:0>this.deltav.y?0.3:0,this.deltav.y=0):(this.eyeballfloat.y=0.3,this.deltav.y=3))};Cthing.prototype.everySecond=function(a){this.muto?this.everySecondMuto(a):this.everySecondNormal(a)};
Cthing.prototype.updateSound=function(){this.world.player&&(!this.cthingsoundplaying&&this.alien.visible&&(this.cthingsoundplaying=!0,this.cthingsound.play()),this.cthingsoundplaying&&!this.visible&&(this.cthingsound.stop(),this.cthingsoundplaying=!1))};
Cthing.prototype.updateTexture=function(){var a;this.textureincrement+=this.texturevector;this.textureincrement>=this.textures.length&&(this.texturevector=-this.texturevector,this.textureincrement+=2*this.texturevector);0>this.textureincrement&&(this.textureincrement=0,this.texturevector=-this.texturevector);a=this.manattached?PIXI.Texture.fromFrame(this.textures_capture[this.textureincrement]):PIXI.Texture.fromFrame(this.textures[this.textureincrement]);this.alien.setTexture(a);this.timeoutID=setTimeout(this.updateTexture.bind(this),
160)};
Cthing.prototype.update=function(a,b){var c,e=this.worldy,d,f=-1;this.alien.visible=!1;this.worldx+=this.deltav.x*b*60/1E3;this.worldy+=this.deltav.y*b*60/1E3;0>this.worldy&&(this.worldy=0,this.deltav.y=-this.deltav.y);this.worldy>=this.viewheight-this.height&&(this.worldy=this.viewheight-this.height,this.deltav.y=-this.deltav.y);this.worldx>this.worldwidth&&(this.worldx=this.worldx-this.worldwidth+1);0>this.worldx&&(this.worldx=this.worldwidth+this.worldx-1);d=a+this.viewwidth;d>this.worldwidth&&(f=
d-this.worldwidth+1);-1===f?this.worldx>a-this.width&&this.worldx<d+this.width&&(c=this.worldx-a,this.alien.visible=!0):this.worldx>a-this.width&&this.worldx<=this.worldwidth?(c=this.worldx-a,this.alien.visible=!0):this.worldx<f+this.width&&(c=this.worldwidth-a+this.worldx,this.alien.visible=!0);this.alien.visible&&(this.position.x=c,this.position.y=e);this.updateEyeball(a,b);this.manattached&&(this.manattached.sprite.worldx=this.worldx+26,this.manattached.sprite.worldy=this.worldy+64);1>=this.worldy&&
this.manattached&&(this.world.manBlooie(this.manattached),this.manattached=null,this.muto=!0,this.alien.tint=16711680,this.eyeball.tint=65280);this.updateSound()};
Cthing.prototype.updateEyeball=function(a,b){this.eyeball.visible=this.alien.visible;this.eyeball.position.x+=this.eyeballfloat.x;this.eyeball.position.y+=this.eyeballfloat.y;9>this.eyeball.position.y&&(this.eyeball.position.y=9);14<this.eyeball.position.y&&(this.eyeball.position.y=14);6>this.eyeball.position.x&&(this.eyeball.position.x=6);14<this.eyeball.position.x&&(this.eyeball.position.x=14);0>this.deltav.x&&(this.eyeballfloat.x-=0.1);0<this.deltav.x&&(this.eyeballfloat.x+=0.1);0===this.deltav.x&&
(this.eyeballfloat.x=10.2<this.eyeball.position.x?this.eyeballfloat.x-0.1:9.8>this.eyeball.position.x?this.eyeballfloat.x+0.1:0);-0.3>this.eyeballfloat.x&&(this.eyeballfloat.x=-0.3);0.3<this.eyeballfloat.x&&(this.eyeballfloat.x=0.3);0>this.deltav.y&&(this.eyeballfloat.y-=0.1);0<this.deltav.y&&(this.eyeballfloat.y+=0.1);0===this.deltav.y&&(this.eyeballfloat.y=11.7<this.eyeball.position.y?this.eyeballfloat.y-0.05:11.3>this.eyeball.position.y?this.eyeballfloat.y+0.05:0);-0.2>this.eyeballfloat.y&&(this.eyeballfloat.y=
-0.2);0.2<this.eyeballfloat.y&&(this.eyeballfloat.y=0.2)};
